(()=>{"use strict";var t,e=(t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}),r=function(t){function r(){var e=t.call(this,'AFF not ready yet. Remember awaiting the "aff.ready" promise, before accessing any methods or properties.')||this;return e.name="AFFNotReadyError",e}return e(r,t),r}(Error),n=new Map([[0,"OK"],[-1,"Unknown Error"],[-2,"Read Error"],[-3,"Argument Error"],[-4,"Invalid State"],[-5,"IO Error"],[-6,"Compression Error"],[-7,"Invalid State"]]),o=function(t){function r(e){var r,o=this,i=null!==(r=n.get(e))&&void 0!==r?r:"Unknown Error Code";return(o=t.call(this,i+" (Code: "+e+")")||this).name="AFFExceptionError",o}return e(r,t),r}(Error),i=function(){function t(t,e){var r=this;this.instance=null,this.memory=new WebAssembly.Memory({initial:256,maximum:32768}),this.dataView=new DataView(this.memory.buffer),this.ready=WebAssembly.instantiateStreaming(t,{env:{memory:this.memory,__sys_stat64:function(t,e){return r.setErrNo(5),-1},emscripten_notify_memory_growth:function(t){return r.updateViews()}},wasi_snapshot_preview1:{fd_read:function(t,e,n,o){return r.setErrNo(5),-1},fd_close:function(t){return r.setErrNo(5),-1},fd_seek:function(t,e,n,o,i){return r.setErrNo(5),-1},fd_write:function(t,e,n,o){return r.setErrNo(5),-1},environ_sizes_get:function(t,e){return r.dataView.setInt32(t,0,!0),r.dataView.setInt32(e,0,!0),0},environ_get:function(t,e){return 0},proc_exit:function(t){var r;null===(r=null==e?void 0:e.exit)||void 0===r||r.call(e,t)}}}).then((function(t){var e=t.instance;r.instance=e,r.updateViews()}))}return Object.defineProperty(t.prototype,"exports",{get:function(){var t;return null===(t=this.instance)||void 0===t?void 0:t.exports},enumerable:!1,configurable:!0}),t.prototype.updateViews=function(){this.dataView=new DataView(this.memory.buffer)},t.prototype.malloc=function(t){if(null===this.exports)throw new r;var e=this.exports.malloc(t);if(0===e)throw new Error("Failed to allocate memory");return e},t.prototype.free=function(t){if(null===this.exports)throw new r;this.exports.free(t)},t.prototype.writeBufferToMemory=function(t){for(var e=this.malloc(t.byteLength),r=new Uint8Array(t),n=0;n<r.length;n++)this.dataView.setUint8(e+n,r[n]);return e},t.prototype.getBytesFromMemory=function(t,e){return new Uint8Array(this.memory.buffer).slice(t,t+e)},t.prototype.setErrNo=function(t){if(null===this.exports)throw new r;this.dataView.setInt32(this.exports.__errno_location(),t)},t.prototype.getLastAFFException=function(){if(null===this.exports)throw new r;var t=this.exports.get_last_aff_exception();return new o(t)},t.prototype.encode=function(t){if(null===this.exports)throw new r;var e=this.malloc(4),n=this.writeBufferToMemory(t.data.buffer),o=this.exports.encode(t.width,t.height,n,e);if(0===o)throw this.getLastAFFException();var i=this.dataView.getUint32(e,!0),a=this.getBytesFromMemory(o,i);if(0===this.exports.free_encoded_data(o))throw this.getLastAFFException();return this.free(e),this.free(n),a},t.prototype.decode=function(t){if(null===this.exports)throw new r;var e=this.malloc(4),n=this.malloc(2),o=this.malloc(2),i=this.writeBufferToMemory(t.buffer),a=this.exports.decode(i,t.length,n,o,e);if(0===a)throw this.getLastAFFException();var s=this.dataView.getUint32(e,!0),u=this.dataView.getUint16(n,!0),c=this.dataView.getUint16(o,!0),f=this.getBytesFromMemory(a,s),l=new ImageData(new Uint8ClampedArray(f.buffer),u,c);return this.free(e),this.free(n),this.free(o),this.free(i),l},t}();function a(t,e){return void 0===t&&(t="/grad_aff_paa.wasm"),r=this,n=void 0,a=function(){var r;return function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(n){switch(n.label){case 0:return("string"==typeof t||t instanceof Request||t instanceof URL)&&(t instanceof URL&&(t=t.toString()),t=fetch(t)),[4,(r=new i(t,e)).ready];case 1:return n.sent(),[2,r]}}))},new((o=void 0)||(o=Promise))((function(t,e){function i(t){try{u(a.next(t))}catch(t){e(t)}}function s(t){try{u(a.throw(t))}catch(t){e(t)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o((function(t){t(r)}))).then(i,s)}u((a=a.apply(r,n||[])).next())}));var r,n,o,a}var s=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},u=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function c(t){return s(this,void 0,void 0,(function(){var e,r;return u(this,(function(n){switch(n.label){case 0:return[4,a()];case 1:return e=n.sent(),r=e.encode(t),[2,new Blob([r.buffer],{type:"image/vnd.paa"})]}}))}))}addEventListener("message",(function(t){return s(void 0,void 0,void 0,(function(){var e,r,n,o;return u(this,(function(i){switch(i.label){case 0:e=t.data,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,c(e)];case 2:return n=i.sent(),r={type:"data",data:n},[3,4];case 3:return o=i.sent(),r={type:"error",data:o},[3,4];case 4:return postMessage(r,this),[2]}}))}))}))})();