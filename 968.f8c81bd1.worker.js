(()=>{"use strict";var t=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))};class e extends Error{constructor(){super('AFF not ready yet. Remember awaiting the "aff.ready" promise, before accessing any methods or properties.'),this.name="AFFNotReadyError"}}const r=new Map([[0,"OK"],[-1,"Unknown Error"],[-2,"Read Error"],[-3,"Argument Error"],[-4,"Invalid State"],[-5,"IO Error"],[-6,"Compression Error"],[-7,"Invalid State"]]);class n extends Error{constructor(t){var e;super(`${null!==(e=r.get(t))&&void 0!==e?e:"Unknown Error Code"} (Code: ${t})`),this.name="AFFExceptionError"}}class i{constructor(e,r){this.instance=null,this.memory=new WebAssembly.Memory({initial:256,maximum:32768}),this.dataView=new DataView(this.memory.buffer),this.ready=function(e,r){return t(this,void 0,void 0,(function*(){if(void 0!==WebAssembly.instantiateStreaming){const{instance:t}=yield WebAssembly.instantiateStreaming(e,r);return t}const t=(yield e).arrayBuffer();return WebAssembly.instantiate(t,r)}))}(e,{env:{memory:this.memory,__sys_stat64:(t,e)=>(this.setErrNo(5),-1),emscripten_notify_memory_growth:t=>this.updateViews()},wasi_snapshot_preview1:{fd_read:(t,e,r,n)=>(this.setErrNo(5),-1),fd_close:t=>(this.setErrNo(5),-1),fd_seek:(t,e,r,n,i)=>(this.setErrNo(5),-1),fd_write:(t,e,r,n)=>(this.setErrNo(5),-1),environ_sizes_get:(t,e)=>(this.dataView.setInt32(t,0,!0),this.dataView.setInt32(e,0,!0),0),environ_get:(t,e)=>0,proc_exit:t=>{var e;null===(e=null==r?void 0:r.exit)||void 0===e||e.call(r,t)}}}).then((t=>{this.instance=t,this.updateViews()}))}get exports(){var t;return null===(t=this.instance)||void 0===t?void 0:t.exports}updateViews(){this.dataView=new DataView(this.memory.buffer)}malloc(t){if(null===this.exports)throw new e;const r=this.exports.malloc(t);if(0===r)throw new Error("Failed to allocate memory");return r}free(t){if(null===this.exports)throw new e;this.exports.free(t)}writeBufferToMemory(t){const e=this.malloc(t.byteLength),r=new Uint8Array(t);for(let t=0;t<r.length;t++)this.dataView.setUint8(e+t,r[t]);return e}getBytesFromMemory(t,e){return new Uint8Array(this.memory.buffer).slice(t,t+e)}setErrNo(t){if(null===this.exports)throw new e;this.dataView.setInt32(this.exports.__errno_location(),t)}getLastAFFException(){if(null===this.exports)throw new e;const t=this.exports.get_last_aff_exception();return new n(t)}encode(t){if(null===this.exports)throw new e;const r=this.malloc(4),n=this.writeBufferToMemory(t.data.buffer),i=this.exports.encode(t.width,t.height,n,r);if(0===i)throw this.getLastAFFException();const o=this.dataView.getUint32(r,!0),s=this.getBytesFromMemory(i,o);if(0===this.exports.free_encoded_data(i))throw this.getLastAFFException();return this.free(r),this.free(n),s}decode(t){if(null===this.exports)throw new e;const r=this.malloc(4),n=this.malloc(2),i=this.malloc(2),o=this.writeBufferToMemory(t.buffer),s=this.exports.decode(o,t.length,n,i,r);if(0===s)throw this.getLastAFFException();const a=this.dataView.getUint32(r,!0),h=this.dataView.getUint16(n,!0),c=this.dataView.getUint16(i,!0),f=this.getBytesFromMemory(s,a),d=new ImageData(new Uint8ClampedArray(f.buffer),h,c);return this.free(r),this.free(n),this.free(i),this.free(o),d}}var o=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))};function s(e){return o(this,void 0,void 0,(function*(){const r=yield(n=e,new Promise(((t,e)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=e,r.readAsArrayBuffer(n)})));var n;const o=new Uint8Array(r);return(yield function(e="/grad_aff_paa.wasm",r){return t(this,void 0,void 0,(function*(){("string"==typeof e||e instanceof Request||e instanceof URL)&&(e instanceof URL&&(e=e.toString()),e=fetch(e));const t=new i(e,r);return yield t.ready,t}))}()).decode(o)}))}addEventListener("message",(t=>o(void 0,void 0,void 0,(function*(){const e=t.data;let r;try{r={type:"data",data:yield s(e)}}catch(t){r={type:"error",data:t}}postMessage(r,this)}))))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wYWEuZ3J1cHBlLWFkbGVyLmRlLy4vc3JjL3V0aWxzL2FmZi50cyIsIndlYnBhY2s6Ly9wYWEuZ3J1cHBlLWFkbGVyLmRlLy4vc3JjL3dvcmtlci9mcm9tUEFBLndvcmtlci50cyIsIndlYnBhY2s6Ly9wYWEuZ3J1cHBlLWFkbGVyLmRlLy4vc3JjL3V0aWxzL2ZpbGUudHMiXSwibmFtZXMiOlsiQUZGTm90UmVhZHlFcnJvciIsIkVycm9yIiwic3VwZXIiLCJuYW1lIiwiQUZGX0VYQ0VQVElPTl9NU0dTIiwiTWFwIiwiQUZGRXhjZXB0aW9uRXJyb3IiLCJjb2RlIiwiZ2V0IiwidGhpcyIsIkFGRiIsImlucHV0Iiwib3B0aW9ucyIsImluc3RhbmNlIiwibWVtb3J5IiwiV2ViQXNzZW1ibHkiLCJNZW1vcnkiLCJpbml0aWFsIiwibWF4aW11bSIsImRhdGFWaWV3IiwiRGF0YVZpZXciLCJidWZmZXIiLCJyZWFkeSIsInJlc3BvbnNlIiwiaW1wb3J0T2JqZWN0IiwidW5kZWZpbmVkIiwiaW5zdGFudGlhdGVTdHJlYW1pbmciLCJieXRlcyIsImFycmF5QnVmZmVyIiwiaW5zdGFudGlhdGUiLCJpbnN0YW50aWF0ZVdBIiwiZW52IiwiX19zeXNfc3RhdDY0IiwicGF0aFB0ciIsImJ1ZmZlclB0ciIsInNldEVyck5vIiwiZW1zY3JpcHRlbl9ub3RpZnlfbWVtb3J5X2dyb3d0aCIsImluZGV4IiwidXBkYXRlVmlld3MiLCJ3YXNpX3NuYXBzaG90X3ByZXZpZXcxIiwiZmRfcmVhZCIsImZkIiwiaW92IiwiaW92Q291bnQiLCJwbnVtIiwiZmRfY2xvc2UiLCJmZF9zZWVrIiwib2Zmc2V0TG93Iiwib2Zmc2V0SGlnaCIsIndoZW5jZSIsIm5ld09mZnNldCIsImZkX3dyaXRlIiwiZW52aXJvbl9zaXplc19nZXQiLCJwZW52aXJvbkNvdW50UHRyIiwicGVudmlyb25CdWZmZXJTaXplUHRyIiwic2V0SW50MzIiLCJlbnZpcm9uX2dldCIsImVudmlyb24iLCJlbnZpcm9uQnVmZmVyUHRyIiwicHJvY19leGl0IiwiZXhpdENvZGUiLCJleGl0IiwidGhlbiIsImV4cG9ydHMiLCJzaXplIiwicHRyIiwibWFsbG9jIiwiZnJlZSIsImJ5dGVMZW5ndGgiLCJhcnIiLCJVaW50OEFycmF5IiwiaSIsImxlbmd0aCIsInNldFVpbnQ4Iiwic2xpY2UiLCJlcnJubyIsIl9fZXJybm9fbG9jYXRpb24iLCJudW0iLCJnZXRfbGFzdF9hZmZfZXhjZXB0aW9uIiwiaW1hZ2VEYXRhIiwic2l6ZVB0ciIsImltYWdlRGF0YVB0ciIsIndyaXRlQnVmZmVyVG9NZW1vcnkiLCJkYXRhIiwiZW5jb2RlIiwid2lkdGgiLCJoZWlnaHQiLCJnZXRMYXN0QUZGRXhjZXB0aW9uIiwiZ2V0VWludDMyIiwib3V0cHV0IiwiZ2V0Qnl0ZXNGcm9tTWVtb3J5IiwiZnJlZV9lbmNvZGVkX2RhdGEiLCJvdXRwdXRTaXplUHRyIiwid2lkdGhQdHIiLCJoZWlnaHRQdHIiLCJkYXRhUHRyIiwiZGVjb2RlIiwiZ2V0VWludDE2IiwiaW1hZ2UiLCJJbWFnZURhdGEiLCJVaW50OENsYW1wZWRBcnJheSIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJhcHBseSIsImNvbnZlcnRQYWFUb0ltYWdlIiwiYmxvYiIsImZpbGUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwib25lcnJvciIsInJlYWRBc0FycmF5QnVmZmVyIiwidWludDhhcnJheSIsIlJlcXVlc3QiLCJVUkwiLCJ0b1N0cmluZyIsImZldGNoIiwiaW5pdE9iaiIsImluaXQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJtc2ciLCJ0eXBlIiwiZXJyIiwicG9zdE1lc3NhZ2UiXSwibWFwcGluZ3MiOiI2VEFpQk8sTUFBTUEsVUFBeUJDLE1BR2xD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LElBQUliLFNBQVEsQ0FBQ0MsRUFBU0MsS0FDekIsTUFBTWEsRUFBUyxJQUFJQyxXQUNuQkQsRUFBT0UsT0FBUyxJQUFNaEIsRUFBUWMsRUFBT04sUUFDckNNLEVBQU9HLFFBQVVoQixFQUNqQmEsRUFBT0ksa0JBQWtCTCxPQUwxQixJQUFtQkEsRUQ3Q2xCLE1BQU1NLEVBQWEsSUFBSXZELFdBQVcxQyxHQUVsQyxhRDBUTyxTQUFvQmpCLEVBQTRELHFCQUFzQkMsRywwQ0FDNUYsaUJBQVZELEdBQXNCQSxhQUFpQm1ILFNBQVduSCxhQUFpQm9ILE9BQ3RFcEgsYUFBaUJvSCxNQUFLcEgsRUFBUUEsRUFBTXFILFlBRXhDckgsRUFBUXNILE1BQU10SCxJQUdsQixNQUFNdUgsRUFBVSxJQUFJeEgsRUFBSUMsRUFBT0MsR0FHL0IsYUFGTXNILEVBQVE1RyxNQUVQNEcsS0NyVWVDLElBQ1BuQyxPQUFPNkIsTUFHMUJPLGlCQUFpQixXQUFZQyxHQUFVLE9BQVUsT0FBUSxPQUFRLEdBQVEsWUFDckUsTUFBTWYsRUFBT2UsRUFBTWxELEtBQ25CLElBQUltRCxFQUNKLElBRUlBLEVBQU0sQ0FBRUMsS0FBTSxPQUFRcEQsV0FERWtDLEVBQWtCQyxJQUc5QyxNQUFPa0IsR0FDSEYsRUFBTSxDQUFFQyxLQUFNLFFBQVNwRCxLQUFNcUQsR0FHakNDLFlBQVlILEVBQUs3SCxZIiwiZmlsZSI6Ijk2OC5mOGM4MWJkMS53b3JrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBjYW1lbGNhc2UsIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycyAqL1xuY29uc3QgTlVMTF9QT0lOVEVSID0gMDtcblxuaW50ZXJmYWNlIEFGRkV4cG9ydHMgZXh0ZW5kcyBXZWJBc3NlbWJseS5FeHBvcnRzIHtcbiAgICBlbmNvZGU6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgZGF0YTogbnVtYmVyLCBzaXplOiBudW1iZXIpID0+IG51bWJlcjtcbiAgICBmcmVlX2VuY29kZWRfZGF0YTogKHB0cjogbnVtYmVyKSA9PiAwfDE7XG4gICAgZGVjb2RlOiAoZGF0YTogbnVtYmVyLCBkYXRhU2l6ZTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgc2l6ZTogbnVtYmVyKSA9PiBudW1iZXI7XG4gICAgZ2V0X2xhc3RfYWZmX2V4Y2VwdGlvbjogKCkgPT4gbnVtYmVyO1xuICAgIGZyZWU6IChwdHI6IG51bWJlcikgPT4gbnVtYmVyO1xuICAgIG1hbGxvYzogKHNpemU6IG51bWJlcikgPT4gbnVtYmVyO1xuICAgIF9fZXJybm9fbG9jYXRpb246ICgpID0+IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIEFGRk9wdGlvbnMge1xuICAgIGV4aXQ/OiAoZXhpdENvZGU6IG51bWJlcikgPT4gdW5rbm93bjtcbn1cblxuZXhwb3J0IGNsYXNzIEFGRk5vdFJlYWR5RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgcHVibGljIHJlYWRvbmx5IG5hbWUgPSAnQUZGTm90UmVhZHlFcnJvcic7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ0FGRiBub3QgcmVhZHkgeWV0LiBSZW1lbWJlciBhd2FpdGluZyB0aGUgXCJhZmYucmVhZHlcIiBwcm9taXNlLCBiZWZvcmUgYWNjZXNzaW5nIGFueSBtZXRob2RzIG9yIHByb3BlcnRpZXMuJyk7XG4gICAgfVxufVxuXG5jb25zdCBBRkZfRVhDRVBUSU9OX01TR1MgPSBuZXcgTWFwPG51bWJlciwgc3RyaW5nPihbXG4gICAgWzAsICdPSyddLFxuICAgIFstMSwgJ1Vua25vd24gRXJyb3InXSxcbiAgICBbLTIsICdSZWFkIEVycm9yJ10sXG4gICAgWy0zLCAnQXJndW1lbnQgRXJyb3InXSxcbiAgICBbLTQsICdJbnZhbGlkIFN0YXRlJ10sXG4gICAgWy01LCAnSU8gRXJyb3InXSxcbiAgICBbLTYsICdDb21wcmVzc2lvbiBFcnJvciddLFxuICAgIFstNywgJ0ludmFsaWQgU3RhdGUnXVxuXSk7XG5cbmV4cG9ydCBjbGFzcyBBRkZFeGNlcHRpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2RlOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IEFGRl9FWENFUFRJT05fTVNHUy5nZXQoY29kZSkgPz8gJ1Vua25vd24gRXJyb3IgQ29kZSc7XG5cbiAgICAgICAgc3VwZXIoYCR7bWVzc2FnZX0gKENvZGU6ICR7Y29kZX0pYCk7XG5cbiAgICAgICAgdGhpcy5uYW1lID0gJ0FGRkV4Y2VwdGlvbkVycm9yJztcbiAgICB9XG59XG5cbi8vIFNhZmFyaSBzdGlsbCBjYW4ndCBoYW5kbGUgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcuLi5cbmFzeW5jIGZ1bmN0aW9uIGluc3RhbnRpYXRlV0EocmVzcG9uc2U6IFJlc3BvbnNlIHwgUHJvbWlzZUxpa2U8UmVzcG9uc2U+LCBpbXBvcnRPYmplY3Q/OiBXZWJBc3NlbWJseS5JbXBvcnRzKTogUHJvbWlzZTxXZWJBc3NlbWJseS5JbnN0YW5jZT4ge1xuICAgIGlmIChXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IHsgaW5zdGFuY2UgfSA9IGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKHJlc3BvbnNlLCBpbXBvcnRPYmplY3QpO1xuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgfVxuXG4gICAgY29uc3QgYnl0ZXMgPSAoYXdhaXQgcmVzcG9uc2UpLmFycmF5QnVmZmVyKCk7XG4gICAgcmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGJ5dGVzLCBpbXBvcnRPYmplY3QpO1xufVxuXG5leHBvcnQgY2xhc3MgQUZGIHtcbiAgICBwcml2YXRlIGRhdGFWaWV3OiBEYXRhVmlldztcbiAgICBwcml2YXRlIGluc3RhbmNlOiBXZWJBc3NlbWJseS5JbnN0YW5jZXxudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIG1lbW9yeTogV2ViQXNzZW1ibHkuTWVtb3J5O1xuICAgIHB1YmxpYyByZWFkb25seSByZWFkeTogUHJvbWlzZTx2b2lkPjtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7UmVzcG9uc2V8UHJvbWlzZUxpa2U8UmVzcG9uc2U+fSBpbnB1dCAoUHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvKSBSZXNwb25zZSwgd2hpY2ggaW5jbHVkZXMgV0FTTSBNb2R1bGVcbiAgICAgKiBAcGFyYW0ge0FGRk9wdGlvbnN9IG9wdGlvbnMgT3B0aW9uc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGlucHV0OiBSZXNwb25zZXxQcm9taXNlTGlrZTxSZXNwb25zZT4sIG9wdGlvbnM/OiBBRkZPcHRpb25zKSB7XG4gICAgICAgIHRoaXMubWVtb3J5ID0gbmV3IFdlYkFzc2VtYmx5Lk1lbW9yeSh7IGluaXRpYWw6IDI1NiwgbWF4aW11bTogMzI3NjggfSk7XG4gICAgICAgIHRoaXMuZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKTtcblxuICAgICAgICB0aGlzLnJlYWR5ID0gaW5zdGFudGlhdGVXQShcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGVudjoge1xuICAgICAgICAgICAgICAgICAgICBtZW1vcnk6IHRoaXMubWVtb3J5LFxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogR2V0IGluZm9ybWF0aW9uIGFib3V0IGEgZmlsZSBvciBkaXJlY3RvcnksIGdpdmVuIGEgcGF0aFxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gcGF0aFB0ciBUaGUgcGF0aCBvZiB0aGUgZmlsZSBvciBkaXJlY3RvcnkgdGhhdCB5b3Ugd2FudCBpbmZvcm1hdGlvbiBhYm91dC4gKGNoYXIgKilcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGJ1ZmZlclB0ciBBIHBvaW50ZXIgdG8gYSBidWZmZXIgd2hlcmUgdGhlIGZ1bmN0aW9uIGNhbiBzdG9yZSB0aGUgaW5mb3JtYXRpb24gKHN0cnVjdCBzdGF0NjQgKilcbiAgICAgICAgICAgICAgICAgICAgICogQHJldHVybnMgezB8LTF9IDAgPSBTdWNjZXNzIC8gLTEgPSBBbiBlcnJvciBvY2N1cnJlZCAoZXJybm8gaXMgc2V0KS5cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIF9fc3lzX3N0YXQ2NDogKHBhdGhQdHI6IG51bWJlciwgYnVmZmVyUHRyOiBudW1iZXIpOiAwfC0xID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyTm8oNSk7IC8vIEVJTzogSW5wdXQvb3V0cHV0IGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIENhbGxlZCB3aGVuIG1lbW9yeSBoYXMgZ3Jvd24uIEluIGEgSlMgcnVudGltZSwgdGhpcyBpcyB1c2VkIHRvIGtub3cgd2hlbiB0byB1cGRhdGUgdGhlIEpTIHZpZXdzXG4gICAgICAgICAgICAgICAgICAgICAqIG9uIHRoZSB3YXNtIG1lbW9yeSwgd2hpY2ggb3RoZXJ3aXNlIHdlIHdvdWxkIG5lZWQgdG8gY29uc3RhbnRseSBjaGVjayBmb3IgYWZ0ZXIgYW55IHdhc20gY29kZVxuICAgICAgICAgICAgICAgICAgICAgKiBydW5zLiBTZWUgW3RoaXMgd2FzaSBkaXNjdXNzaW9uXShodHRwczovL2dpdGh1Yi5jb20vV2ViQXNzZW1ibHkvV0FTSS9pc3N1ZXMvODIpLlxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggV2hpY2ggbWVtb3J5IGhhcyBncm93blxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZW1zY3JpcHRlbl9ub3RpZnlfbWVtb3J5X2dyb3d0aDogKGluZGV4OiBudW1iZXIpID0+IHRoaXMudXBkYXRlVmlld3MoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgd2FzaV9zbmFwc2hvdF9wcmV2aWV3MToge1xuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogUmVhZCBmcm9tIGEgZmlsZSBkZXNjcmlwdG9yXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBmZCBGaWxlIGRlc2NyaXB0b3JcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGlvdlxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gaW92Y250XG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwbnVtXG4gICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHswfC0xfSAwID0gU3VjY2VzcyAvIC0xID0gQW4gZXJyb3Igb2NjdXJyZWQgKGVycm5vIGlzIHNldCkuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBmZF9yZWFkOiAoZmQ6IG51bWJlciwgaW92OiBudW1iZXIsIGlvdkNvdW50OiBudW1iZXIsIHBudW06IG51bWJlcik6IDB8LTEgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFcnJObyg1KTsgLy8gRUlPOiBJbnB1dC9vdXRwdXQgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogTG9zZSBhIGZpbGUgZGVzY3JpcHRvclxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gZmQgRmlsZSBkZXNjcmlwdG9yXG4gICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHswfC0xfSAwID0gU3VjY2VzcyAvIC0xID0gQW4gZXJyb3Igb2NjdXJyZWQgKGVycm5vIGlzIHNldCkuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBmZF9jbG9zZTogKGZkOiBudW1iZXIpOiAwfC0xID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyTm8oNSk7IC8vIEVJTzogSW5wdXQvb3V0cHV0IGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIFJlcG9zaXRpb24gcmVhZC93cml0ZSBmaWxlIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gZmQgRmlsZSBkZXNjcmlwdG9yXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXRMb3dcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldEhpZ2hcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHdoZW5jZVxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gbmV3T2Zmc2V0XG4gICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHswfC0xfSAwID0gU3VjY2VzcyAvIC0xID0gQW4gZXJyb3Igb2NjdXJyZWQgKGVycm5vIGlzIHNldCkuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBmZF9zZWVrOiAoZmQ6IG51bWJlciwgb2Zmc2V0TG93OiBudW1iZXIsIG9mZnNldEhpZ2g6IG51bWJlciwgd2hlbmNlOiBudW1iZXIsIG5ld09mZnNldDogbnVtYmVyKTogMHwtMSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVyck5vKDUpOyAvLyBFSU86IElucHV0L291dHB1dCBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBXcml0ZSB0byBhIGZpbGUgZGVzY3JpcHRvclxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gZmQgRmlsZSBkZXNjcmlwdG9yXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpb3ZcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGlvdkNvdW50XG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwbnVtXG4gICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHswfC0xfSAwID0gU3VjY2VzcyAvIC0xID0gQW4gZXJyb3Igb2NjdXJyZWQgKGVycm5vIGlzIHNldCkuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBmZF93cml0ZTogKGZkOiBudW1iZXIsIGlvdjogbnVtYmVyLCBpb3ZDb3VudDogbnVtYmVyLCBwbnVtOiBudW1iZXIpOiAwfC0xID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyTm8oNSk7IC8vIEVJTzogSW5wdXQvb3V0cHV0IGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIFJldHVybiBjb21tYW5kLWxpbmUgYXJndW1lbnQgZGF0YSBzaXplcy5cbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHBlbnZpcm9uQ291bnQgKE91dHB1dCBwb2ludGVyKSBUaGUgbnVtYmVyIG9mIGFyZ3VtZW50cy5cbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHBlbnZpcm9uQnVmZmVyU2l6ZSAoT3V0cHV0IHBvaW50ZXIpIFRoZSBzaXplIG9mIHRoZSBhcmd1bWVudCBzdHJpbmcgZGF0YS5cbiAgICAgICAgICAgICAgICAgICAgICogQHJldHVybnMgezB9XG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBlbnZpcm9uX3NpemVzX2dldDogKHBlbnZpcm9uQ291bnRQdHI6IG51bWJlciwgcGVudmlyb25CdWZmZXJTaXplUHRyOiBudW1iZXIpOiAwfC0xID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YVZpZXcuc2V0SW50MzIocGVudmlyb25Db3VudFB0ciwgMCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFWaWV3LnNldEludDMyKHBlbnZpcm9uQnVmZmVyU2l6ZVB0ciwgMCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbl9nZXQ6IChlbnZpcm9uOiBudW1iZXIsIGVudmlyb25CdWZmZXJQdHI6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIENhbGxlZCBvbiBwcm9ncmFtIGV4aXRcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGV4aXRDb2RlIEV4aXQgY29kZVxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgcHJvY19leGl0OiAoZXhpdENvZGU6IG51bWJlcik6IHZvaWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucz8uZXhpdD8uKGV4aXRDb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKS50aGVuKGluc3RhbmNlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVmlld3MoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgZXhwb3J0cygpOiBBRkZFeHBvcnRzfG51bGwge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZT8uZXhwb3J0cyBhcyBBRkZFeHBvcnRzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGlzLmRhdGFWaWV3LiBUaGlzIGlzIGNhbGxlZCBvbmNlIGluaXRpYWxseSwgd2hlbiB0aGUgV0FTTSBsb2Fkc1xuICAgICAqIGFuZCBldmVyeSB0aW1lIG1lbW9yeSBncm93cyAvIHNocmlua3MgYW5kIHRoZXJlZm9yZSB0aGUgdW5kZXJseWluZyBtZW1vcnlcbiAgICAgKiBidWZmZXIgY2hhbmdlcy5cbiAgICAgKi9cbiAgICBwcml2YXRlIHVwZGF0ZVZpZXdzKCkge1xuICAgICAgICB0aGlzLmRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWxsb2NhdGUgbWVtb3J5IGJsb2NrXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHNpemUgU2l6ZSBvZiB0aGUgbWVtb3J5IGJsb2NrLCBpbiBieXRlcy5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGlzIGZ1bmN0aW9uIHJldHVybnMgYSBwb2ludGVyIHRvIHRoZSBhbGxvY2F0ZWQgbWVtb3J5LlxuICAgICAqL1xuICAgIHByaXZhdGUgbWFsbG9jKHNpemU6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGlmICh0aGlzLmV4cG9ydHMgPT09IG51bGwpIHRocm93IG5ldyBBRkZOb3RSZWFkeUVycm9yKCk7XG5cbiAgICAgICAgY29uc3QgcHRyID0gdGhpcy5leHBvcnRzLm1hbGxvYyhzaXplKTtcbiAgICAgICAgaWYgKHB0ciA9PT0gTlVMTF9QT0lOVEVSKSB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhbGxvY2F0ZSBtZW1vcnknKTtcblxuICAgICAgICByZXR1cm4gcHRyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlYWxsb2NhdGUgbWVtb3J5IHByZXZpb3VzbHkgYWxsb2NhdGVkXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHB0ciBUaGlzIGlzIHRoZSBwb2ludGVyIHRvIGEgbWVtb3J5IGJsb2NrIHByZXZpb3VzbHkgYWxsb2NhdGVkXG4gICAgICovXG4gICAgcHJpdmF0ZSBmcmVlKHB0cjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmV4cG9ydHMgPT09IG51bGwpIHRocm93IG5ldyBBRkZOb3RSZWFkeUVycm9yKCk7XG5cbiAgICAgICAgdGhpcy5leHBvcnRzLmZyZWUocHRyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXcml0ZSBidWZmZXIgdG8gbWVtb3J5LiBUaGlzIHdpbGwgYXV0b21hdGljYWxseSBhbGxvY2F0ZSBtZW1vcnkuXG4gICAgICogWW91IHNob3VsZCByZW1lbWJlciB0byBmcmVlIHRoZSBtZW1vcnkgYWZ0ZXIgeW91J3JlIGRvbmUgdXNpbmcgaXQuXG4gICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlckxpa2V9IGJ1ZmZlclxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFBvaW50ZXIgdG8gdGhlIGFsbG9jYXRlZCBtZW1vcnkuXG4gICAgICovXG4gICAgcHJpdmF0ZSB3cml0ZUJ1ZmZlclRvTWVtb3J5KGJ1ZmZlcjogQXJyYXlCdWZmZXJMaWtlKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgcHRyID0gdGhpcy5tYWxsb2MoYnVmZmVyLmJ5dGVMZW5ndGgpO1xuXG4gICAgICAgIGNvbnN0IGFyciA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YVZpZXcuc2V0VWludDgocHRyICsgaSwgYXJyW2ldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwdHI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29weSBmcm9tIG1lbW9yeVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwdHIgUG9pbnRlciB0byBkYXRhXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHNpemUgU2l6ZVxuICAgICAqIEByZXR1cm5zIHtVaW50OEFycmF5fVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0Qnl0ZXNGcm9tTWVtb3J5KHB0cjogbnVtYmVyLCBzaXplOiBudW1iZXIpOiBVaW50OEFycmF5IHtcbiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlcikuc2xpY2UocHRyLCBwdHIgKyBzaXplKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgZXJybm9cbiAgICAgKiBAcGFyYW0gZXJybm8gZXJybm9cbiAgICAgKi9cbiAgICBwcml2YXRlIHNldEVyck5vKGVycm5vOiBudW1iZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuZXhwb3J0cyA9PT0gbnVsbCkgdGhyb3cgbmV3IEFGRk5vdFJlYWR5RXJyb3IoKTtcblxuICAgICAgICB0aGlzLmRhdGFWaWV3LnNldEludDMyKHRoaXMuZXhwb3J0cy5fX2Vycm5vX2xvY2F0aW9uKCksIGVycm5vKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gZXJyb3IsIHdoaWNoIGNvcnJlc3BvbmRzIHRvIGxhc3QgdGhyb3duIGdyYWRfYWZmIGV4Y2VwdGlvblxuICAgICAqIEByZXR1cm5zIEVycm9yIGFjY29yZGluZyB0byBsYXN0IGV4Y2VwdGlvblxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0TGFzdEFGRkV4Y2VwdGlvbigpOiBBRkZFeGNlcHRpb25FcnJvciB7XG4gICAgICAgIGlmICh0aGlzLmV4cG9ydHMgPT09IG51bGwpIHRocm93IG5ldyBBRkZOb3RSZWFkeUVycm9yKCk7XG5cbiAgICAgICAgY29uc3QgbnVtID0gdGhpcy5leHBvcnRzLmdldF9sYXN0X2FmZl9leGNlcHRpb24oKTtcblxuICAgICAgICByZXR1cm4gbmV3IEFGRkV4Y2VwdGlvbkVycm9yKG51bSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jb2RlIGltYWdlIGRhdGEgdG8gUEFBIGJ5dGVzXG4gICAgICogQHBhcmFtIHtJbWFnZURhdGF9IGltYWdlRGF0YSBJbWFnZSBkYXRhXG4gICAgICogQHJldHVybnMge1VpbnQ4QXJyYXl9IGJ5dGUtZW5jb2RlZCBQQUFcbiAgICAgKlxuICAgICAqIEB0aHJvd3Mge0BsaW5rIEFGRk5vdFJlYWR5RXJyb3J9XG4gICAgICogVGhyb3duIGlmIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGJlZm9yZSBBRkYgaW5zdGFuY2UgaXMgcmVhZHkuIChhd2FpdCB0aGUgLnJlYWR5IHByb21pc2UgdG8gcHJldmVudCB0aGlzKVxuICAgICAqXG4gICAgICogQHRocm93cyB7QGxpbmsgQUZGRXhjZXB0aW9uRXJyb3J9XG4gICAgICogVGhyb3duIGlmIGdyYWRfYWZmIGltcGxlbWVudGF0aW9uIHRocm93cyBhbnkgZXhjZXB0aW9ucy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZW5jb2RlKGltYWdlRGF0YTogSW1hZ2VEYXRhKTogVWludDhBcnJheSB7XG4gICAgICAgIGlmICh0aGlzLmV4cG9ydHMgPT09IG51bGwpIHRocm93IG5ldyBBRkZOb3RSZWFkeUVycm9yKCk7XG5cbiAgICAgICAgY29uc3Qgc2l6ZVB0ciA9IHRoaXMubWFsbG9jKDQpO1xuICAgICAgICBjb25zdCBpbWFnZURhdGFQdHIgPSB0aGlzLndyaXRlQnVmZmVyVG9NZW1vcnkoaW1hZ2VEYXRhLmRhdGEuYnVmZmVyKTtcblxuICAgICAgICBjb25zdCBwdHIgPSB0aGlzLmV4cG9ydHMuZW5jb2RlKGltYWdlRGF0YS53aWR0aCwgaW1hZ2VEYXRhLmhlaWdodCwgaW1hZ2VEYXRhUHRyLCBzaXplUHRyKTtcbiAgICAgICAgaWYgKHB0ciA9PT0gTlVMTF9QT0lOVEVSKSB0aHJvdyB0aGlzLmdldExhc3RBRkZFeGNlcHRpb24oKTtcblxuICAgICAgICBjb25zdCBzaXplID0gdGhpcy5kYXRhVmlldy5nZXRVaW50MzIoc2l6ZVB0ciwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IHRoaXMuZ2V0Qnl0ZXNGcm9tTWVtb3J5KHB0ciwgc2l6ZSk7XG5cbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IHRoaXMuZXhwb3J0cy5mcmVlX2VuY29kZWRfZGF0YShwdHIpO1xuICAgICAgICBpZiAoc3VjY2VzcyA9PT0gMCkgdGhyb3cgdGhpcy5nZXRMYXN0QUZGRXhjZXB0aW9uKCk7XG4gICAgICAgIHRoaXMuZnJlZShzaXplUHRyKTtcbiAgICAgICAgdGhpcy5mcmVlKGltYWdlRGF0YVB0cik7XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbmNvZGUgUEFBIGJ5dGVzIHRvIGltYWdlIGRhdGFcbiAgICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IGRhdGEgYnl0ZS1lbmNvZGVkIFBBQVxuICAgICAqIEByZXR1cm5zIHtJbWFnZURhdGF9IGltYWdlIGRhdGFcbiAgICAgKlxuICAgICAqIEB0aHJvd3Mge0BsaW5rIEFGRk5vdFJlYWR5RXJyb3J9XG4gICAgICogVGhyb3duIGlmIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGJlZm9yZSBBRkYgaW5zdGFuY2UgaXMgcmVhZHkuIChhd2FpdCB0aGUgLnJlYWR5IHByb21pc2UgdG8gcHJldmVudCB0aGlzKVxuICAgICAqXG4gICAgICogQHRocm93cyB7QGxpbmsgQUZGRXhjZXB0aW9uRXJyb3J9XG4gICAgICogVGhyb3duIGlmIGdyYWRfYWZmIGltcGxlbWVudGF0aW9uIHRocm93cyBhbnkgZXhjZXB0aW9ucy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZGVjb2RlKGRhdGE6IFVpbnQ4QXJyYXkpOiBJbWFnZURhdGEge1xuICAgICAgICBpZiAodGhpcy5leHBvcnRzID09PSBudWxsKSB0aHJvdyBuZXcgQUZGTm90UmVhZHlFcnJvcigpO1xuXG4gICAgICAgIGNvbnN0IG91dHB1dFNpemVQdHIgPSB0aGlzLm1hbGxvYyg0KTtcbiAgICAgICAgY29uc3Qgd2lkdGhQdHIgPSB0aGlzLm1hbGxvYygyKTtcbiAgICAgICAgY29uc3QgaGVpZ2h0UHRyID0gdGhpcy5tYWxsb2MoMik7XG4gICAgICAgIGNvbnN0IGRhdGFQdHIgPSB0aGlzLndyaXRlQnVmZmVyVG9NZW1vcnkoZGF0YS5idWZmZXIpO1xuXG4gICAgICAgIGNvbnN0IHB0ciA9IHRoaXMuZXhwb3J0cy5kZWNvZGUoZGF0YVB0ciwgZGF0YS5sZW5ndGgsIHdpZHRoUHRyLCBoZWlnaHRQdHIsIG91dHB1dFNpemVQdHIpO1xuICAgICAgICBpZiAocHRyID09PSBOVUxMX1BPSU5URVIpIHRocm93IHRoaXMuZ2V0TGFzdEFGRkV4Y2VwdGlvbigpO1xuXG4gICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLmRhdGFWaWV3LmdldFVpbnQzMihvdXRwdXRTaXplUHRyLCB0cnVlKTtcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmRhdGFWaWV3LmdldFVpbnQxNih3aWR0aFB0ciwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuZGF0YVZpZXcuZ2V0VWludDE2KGhlaWdodFB0ciwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IHRoaXMuZ2V0Qnl0ZXNGcm9tTWVtb3J5KHB0ciwgc2l6ZSk7XG5cbiAgICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShvdXRwdXQuYnVmZmVyKSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAgICAgdGhpcy5mcmVlKG91dHB1dFNpemVQdHIpO1xuICAgICAgICB0aGlzLmZyZWUod2lkdGhQdHIpO1xuICAgICAgICB0aGlzLmZyZWUoaGVpZ2h0UHRyKTtcbiAgICAgICAgdGhpcy5mcmVlKGRhdGFQdHIpO1xuXG4gICAgICAgIHJldHVybiBpbWFnZTtcbiAgICB9XG59XG5cbi8qKlxuICogQHBhcmFtIHtSZXF1ZXN0fFJlcXVlc3RJbmZvfFVSTHxSZXNwb25zZXxQcm9taXNlPFJlc3BvbnNlPn0gaW5wdXRcbiAqL1xuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaW5pdChpbnB1dDogUmVxdWVzdHxSZXF1ZXN0SW5mb3xVUkx8UmVzcG9uc2V8UHJvbWlzZTxSZXNwb25zZT4gPSAnL2dyYWRfYWZmX3BhYS53YXNtJywgb3B0aW9ucz86IEFGRk9wdGlvbnMpOiBQcm9taXNlPEFGRj4ge1xuICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnIHx8IGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCB8fCBpbnB1dCBpbnN0YW5jZW9mIFVSTCkge1xuICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBVUkwpIGlucHV0ID0gaW5wdXQudG9TdHJpbmcoKTtcblxuICAgICAgICBpbnB1dCA9IGZldGNoKGlucHV0KTtcbiAgICB9XG5cbiAgICBjb25zdCBpbml0T2JqID0gbmV3IEFGRihpbnB1dCwgb3B0aW9ucyk7XG4gICAgYXdhaXQgaW5pdE9iai5yZWFkeTtcblxuICAgIHJldHVybiBpbml0T2JqO1xufVxuIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5pbXBvcnQgaW5pdCBmcm9tICdAL3V0aWxzL2FmZic7XG5pbXBvcnQgeyByZWFkRmlsZSB9IGZyb20gJ0AvdXRpbHMvZmlsZSc7XG4vKipcbiAqIEdlbmVyYXRlIGEgaW1hZ2UgZnJvbSBhbiBwYWEgZmlsZSBvYmplY3RcbiAqIEBwYXJhbSB7RmlsZX0gZmlsZSBQYWEgZmlsZVxuICogQHJldHVybnMge1Byb21pc2U8SW1hZ2VEYXRhPn0gSW1hZ2UgRGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29udmVydFBhYVRvSW1hZ2UoYmxvYikge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgcmVhZEZpbGUoYmxvYik7XG4gICAgICAgIGNvbnN0IHVpbnQ4YXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7XG4gICAgICAgIGNvbnN0IGFmZiA9IHlpZWxkIGluaXQoKTtcbiAgICAgICAgcmV0dXJuIGFmZi5kZWNvZGUodWludDhhcnJheSk7XG4gICAgfSk7XG59XG5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKGV2ZW50KSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBibG9iID0gZXZlbnQuZGF0YTtcbiAgICBsZXQgbXNnO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGltYWdlRGF0YSA9IHlpZWxkIGNvbnZlcnRQYWFUb0ltYWdlKGJsb2IpO1xuICAgICAgICBtc2cgPSB7IHR5cGU6ICdkYXRhJywgZGF0YTogaW1hZ2VEYXRhIH07XG4gICAgfVxuICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgbXNnID0geyB0eXBlOiAnZXJyb3InLCBkYXRhOiBlcnIgfTtcbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICBwb3N0TWVzc2FnZShtc2csIHRoaXMpO1xufSkpO1xuIiwiLyoqXG4gKiBXaHkgZG8gd2Ugbm90IGp1c3QgdXNlIEZpbGU/XG4gKiBXZWxsLi4uIGJlY2F1c2Ugb2xkIEVkZ2UgaXMgc2hpdHR5IGFmIGFuZCBjYW4ndCBoYW5kbGUgdGhlIEZpbGUgY29uc3RydWN0b3IgKHNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDMyNDE5MjIpXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR3JhZFBhYUZpbGUge1xuICAgIGJsb2I6IEJsb2I7XG4gICAgbmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgUEFBX01JTUVfVFlQRSA9ICdpbWFnZS92bmQucGFhJztcblxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciBnaXZlbiBmaWxlIGlzIHN1cHBvcnRlZFxuICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGVcbiAqIEByZXR1cm5zIHtib29sZWFufSBGaWxlIGlzIHN1cHBvcnRlZD9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU3VwcG9ydGVkRmlsZSAoeyBibG9iLCBuYW1lIH06IEdyYWRQYWFGaWxlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChbJ2ltYWdlL3BuZycsICdpbWFnZS9zdmcreG1sJywgJ2ltYWdlL2pwZWcnLCBQQUFfTUlNRV9UWVBFXS5pbmNsdWRlcyhibG9iLnR5cGUpIHx8IC9cXC5wYWEkL2kudGVzdChuYW1lKSk7XG59XG5cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gZmlsZSBpcyBzdXBwb3J0ZWRcbiAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxlXG4gKiBAcmV0dXJucyB7c3RyaW5nfHVuZGVmaW5lZH0gZmlsZSBleHRlbnNpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEZpbGVFeHRlbnNpb24gKG5hbWU6IHN0cmluZyk6IHN0cmluZ3x1bmRlZmluZWQge1xuICAgIGNvbnN0IGV4dDogdW5kZWZpbmVkfHN0cmluZyA9IG5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcblxuICAgIHJldHVybiBleHQ/LnRvTG93ZXJDYXNlKCk7XG59XG5cbi8qKlxuICogR2V0IGZpbGUncyBuYW1lIHdpdGhvdXQgZXh0ZW5zaW9uXG4gKiBAcGFyYW0ge0ZpbGV9IGZpbGUgRmlsZVxuICogQHJldHVybnMge3N0cmluZ30gZmlsZSBuYW1lIHdpdGhvdXQgZXh0ZW5zaW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlTmFtZVdpdGhvdXRFeHRlbnNpb24gKG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5hbWUuc3BsaXQoJy4nKS5zbGljZSgwLCAtMSkuam9pbignLicpO1xufVxuXG4vKipcbiAqIERvd25sb2FkIGdpdmVuIGZpbGVcbiAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxlIHRvIGRvd25sb2FkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkb3dubG9hZCAoZmlsZTogR3JhZFBhYUZpbGUpOiB2b2lkIHtcbiAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUuYmxvYik7XG5cbiAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIGxpbmsuZG93bmxvYWQgPSBmaWxlLm5hbWU7XG4gICAgbGluay5ocmVmID0gdXJsO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XG4gICAgbGluay5jbGljaygpO1xuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XG4gICAgbGluay5yZW1vdmUoKTtcblxuICAgIC8vIHdlIHJldm9rZSB0aGUgdXJsIG9ubHkgYWZ0ZXIgYSBkZWxheSBiZWNhdXNlIG9sZCBFZGdlIGNhbid0IGhhbmRsZSBpdCBvdGhlcndpc2VcbiAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCksIDIwMCk7XG59XG5cbi8qKlxuICogUmVhZHMgZmlsZSBhcyBhIGFycmF5IGJ1ZmZlclxuICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGUgdG8gcmVhZFxuICogQHJldHVybnMge1Byb21pc2U8QXJyYXlCdWZmZXI+fVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZEZpbGUgKGZpbGU6IEJsb2IpOiBQcm9taXNlPEFycmF5QnVmZmVyPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCBhcyBBcnJheUJ1ZmZlcik7XG4gICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7XG4gICAgfSk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9