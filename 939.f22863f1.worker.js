(()=>{"use strict";var t=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{h(i.next(t))}catch(t){s(t)}}function a(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};class e extends Error{constructor(){super('AFF not ready yet. Remember awaiting the "aff.ready" promise, before accessing any methods or properties.'),this.name="AFFNotReadyError"}}const r=new Map([[0,"OK"],[-1,"Unknown Error"],[-2,"Read Error"],[-3,"Argument Error"],[-4,"Invalid State"],[-5,"IO Error"],[-6,"Compression Error"],[-7,"Invalid State"]]);class i extends Error{constructor(t){var e;super(`${null!==(e=r.get(t))&&void 0!==e?e:"Unknown Error Code"} (Code: ${t})`),this.name="AFFExceptionError"}}class n{constructor(e,r){this.instance=null,this.memory=new WebAssembly.Memory({initial:256,maximum:32768}),this.dataView=new DataView(this.memory.buffer),this.ready=function(e,r){return t(this,void 0,void 0,(function*(){if(void 0!==WebAssembly.instantiateStreaming){const{instance:t}=yield WebAssembly.instantiateStreaming(e,r);return t}const t=yield(yield e).arrayBuffer();return(yield WebAssembly.instantiate(t,r)).instance}))}(e,{env:{memory:this.memory,__sys_stat64:(t,e)=>(this.setErrNo(5),-1),emscripten_notify_memory_growth:t=>this.updateViews()},wasi_snapshot_preview1:{fd_read:(t,e,r,i)=>(this.setErrNo(5),-1),fd_close:t=>(this.setErrNo(5),-1),fd_seek:(t,e,r,i,n)=>(this.setErrNo(5),-1),fd_write:(t,e,r,i)=>(this.setErrNo(5),-1),environ_sizes_get:(t,e)=>(this.dataView.setInt32(t,0,!0),this.dataView.setInt32(e,0,!0),0),environ_get:(t,e)=>0,proc_exit:t=>{var e;null===(e=null==r?void 0:r.exit)||void 0===e||e.call(r,t)}}}).then((t=>{this.instance=t,this.updateViews()}))}get exports(){var t;return null===(t=this.instance)||void 0===t?void 0:t.exports}updateViews(){this.dataView=new DataView(this.memory.buffer)}malloc(t){if(null===this.exports)throw new e;const r=this.exports.malloc(t);if(0===r)throw new Error("Failed to allocate memory");return r}free(t){if(null===this.exports)throw new e;this.exports.free(t)}writeBufferToMemory(t){const e=this.malloc(t.byteLength),r=new Uint8Array(t);for(let t=0;t<r.length;t++)this.dataView.setUint8(e+t,r[t]);return e}getBytesFromMemory(t,e){return new Uint8Array(this.memory.buffer).slice(t,t+e)}setErrNo(t){if(null===this.exports)throw new e;this.dataView.setInt32(this.exports.__errno_location(),t)}getLastAFFException(){if(null===this.exports)throw new e;const t=this.exports.get_last_aff_exception();return new i(t)}encode(t){if(null===this.exports)throw new e;const r=this.malloc(4),i=this.writeBufferToMemory(t.data.buffer),n=this.exports.encode(t.width,t.height,i,r);if(0===n)throw this.getLastAFFException();const s=this.dataView.getUint32(r,!0),o=this.getBytesFromMemory(n,s);if(0===this.exports.free_encoded_data(n))throw this.getLastAFFException();return this.free(r),this.free(i),o}decode(t){if(null===this.exports)throw new e;const r=this.malloc(4),i=this.malloc(2),n=this.malloc(2),s=this.writeBufferToMemory(t.buffer),o=this.exports.decode(s,t.length,i,n,r);if(0===o)throw this.getLastAFFException();const a=this.dataView.getUint32(r,!0),h=this.dataView.getUint16(i,!0),c=this.dataView.getUint16(n,!0),f=this.getBytesFromMemory(o,a),d=new ImageData(new Uint8ClampedArray(f.buffer),h,c);return this.free(r),this.free(i),this.free(n),this.free(s),d}}var s=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{h(i.next(t))}catch(t){s(t)}}function a(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};function o(e){return s(this,void 0,void 0,(function*(){const r=(yield function(e="/grad_aff_paa.wasm",r){return t(this,void 0,void 0,(function*(){("string"==typeof e||e instanceof Request||e instanceof URL)&&(e instanceof URL&&(e=e.toString()),e=fetch(e));const t=new n(e,r);return yield t.ready,t}))}()).encode(e);return new Blob([r.buffer],{type:"image/vnd.paa"})}))}addEventListener("message",(t=>s(void 0,void 0,void 0,(function*(){const e=t.data;let r;try{r={type:"data",data:yield o(e)}}catch(t){r={type:"error",data:t}}postMessage(r,this)}))))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wYWEuZ3J1cHBlLWFkbGVyLmRlLy4vc3JjL3V0aWxzL2FmZi50cyIsIndlYnBhY2s6Ly9wYWEuZ3J1cHBlLWFkbGVyLmRlLy4vc3JjL3dvcmtlci90b1BBQS53b3JrZXIudHMiLCJ3ZWJwYWNrOi8vcGFhLmdydXBwZS1hZGxlci5kZS8uL3NyYy91dGlscy9maWxlLnRzIl0sIm5hbWVzIjpbIkFGRk5vdFJlYWR5RXJyb3IiLCJFcnJvciIsInN1cGVyIiwibmFtZSIsIkFGRl9FWENFUFRJT05fTVNHUyIsIk1hcCIsIkFGRkV4Y2VwdGlvbkVycm9yIiwiY29kZSIsImdldCIsInRoaXMiLCJBRkYiLCJpbnB1dCIsIm9wdGlvbnMiLCJpbnN0YW5jZSIsIm1lbW9yeSIsIldlYkFzc2VtYmx5IiwiTWVtb3J5IiwiaW5pdGlhbCIsIm1heGltdW0iLCJkYXRhVmlldyIsIkRhdGFWaWV3IiwiYnVmZmVyIiwicmVhZHkiLCJyZXNwb25zZSIsImltcG9ydE9iamVjdCIsInVuZGVmaW5lZCIsImluc3RhbnRpYXRlU3RyZWFtaW5nIiwiYnl0ZXMiLCJhcnJheUJ1ZmZlciIsImluc3RhbnRpYXRlIiwiaW5zdGFudGlhdGVXQSIsImVudiIsIl9fc3lzX3N0YXQ2NCIsInBhdGhQdHIiLCJidWZmZXJQdHIiLCJzZXRFcnJObyIsImVtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgiLCJpbmRleCIsInVwZGF0ZVZpZXdzIiwid2FzaV9zbmFwc2hvdF9wcmV2aWV3MSIsImZkX3JlYWQiLCJmZCIsImlvdiIsImlvdkNvdW50IiwicG51bSIsImZkX2Nsb3NlIiwiZmRfc2VlayIsIm9mZnNldExvdyIsIm9mZnNldEhpZ2giLCJ3aGVuY2UiLCJuZXdPZmZzZXQiLCJmZF93cml0ZSIsImVudmlyb25fc2l6ZXNfZ2V0IiwicGVudmlyb25Db3VudFB0ciIsInBlbnZpcm9uQnVmZmVyU2l6ZVB0ciIsInNldEludDMyIiwiZW52aXJvbl9nZXQiLCJlbnZpcm9uIiwiZW52aXJvbkJ1ZmZlclB0ciIsInByb2NfZXhpdCIsImV4aXRDb2RlIiwiZXhpdCIsInRoZW4iLCJleHBvcnRzIiwic2l6ZSIsInB0ciIsIm1hbGxvYyIsImZyZWUiLCJieXRlTGVuZ3RoIiwiYXJyIiwiVWludDhBcnJheSIsImkiLCJsZW5ndGgiLCJzZXRVaW50OCIsInNsaWNlIiwiZXJybm8iLCJfX2Vycm5vX2xvY2F0aW9uIiwibnVtIiwiZ2V0X2xhc3RfYWZmX2V4Y2VwdGlvbiIsImltYWdlRGF0YSIsInNpemVQdHIiLCJpbWFnZURhdGFQdHIiLCJ3cml0ZUJ1ZmZlclRvTWVtb3J5IiwiZGF0YSIsImVuY29kZSIsIndpZHRoIiwiaGVpZ2h0IiwiZ2V0TGFzdEFGRkV4Y2VwdGlvbiIsImdldFVpbnQzMiIsIm91dHB1dCIsImdldEJ5dGVzRnJvbU1lbW9yeSIsImZyZWVfZW5jb2RlZF9kYXRhIiwib3V0cHV0U2l6ZVB0ciIsIndpZHRoUHRyIiwiaGVpZ2h0UHRyIiwiZGF0YVB0ciIsImRlY29kZSIsImdldFVpbnQxNiIsImltYWdlIiwiSW1hZ2VEYXRhIiwiVWludDhDbGFtcGVkQXJyYXkiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwiYXBwbHkiLCJjb252ZXJ0SW1hZ2VUb1BhYSIsInVpbnQ4YXJyYXkiLCJSZXF1ZXN0IiwiVVJMIiwidG9TdHJpbmciLCJmZXRjaCIsImluaXRPYmoiLCJpbml0IiwiQmxvYiIsInR5cGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJpbWFnZURhdGUiLCJtc2ciLCJlcnIiLCJwb3N0TWVzc2FnZSJdLCJtYXBwaW5ncyI6IjZUQWlCTyxNQUFNQSxVQUF5QkMsTUFHbEMsY0FDSUMsTUFBTSw2R0FITSxLQUFBQyxLQUFPLG9CQU8zQixNQUFNQyxFQUFxQixJQUFJQyxJQUFv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aUI2RyxPQUN0RTdHLGFBQWlCNkcsTUFBSzdHLEVBQVFBLEVBQU04RyxZQUV4QzlHLEVBQVErRyxNQUFNL0csSUFHbEIsTUFBTWdILEVBQVUsSUFBSWpILEVBQUlDLEVBQU9DLEdBRy9CLGFBRk0rRyxFQUFRckcsTUFFUHFHLEtDeFVlQyxJQUNLeEMsT0FBT0QsR0FDOUIsT0FBTyxJQUFJMEMsS0FBSyxDQUFDUCxFQUFXakcsUUFBUyxDQUFFeUcsS0NYbEIscUJEYzdCQyxpQkFBaUIsV0FBWUMsR0FBVSxPQUFVLE9BQVEsT0FBUSxHQUFRLFlBQ3JFLE1BQU1DLEVBQVlELEVBQU03QyxLQUN4QixJQUFJK0MsRUFDSixJQUVJQSxFQUFNLENBQUVKLEtBQU0sT0FBUTNDLFdBREhrQyxFQUFrQlksSUFHekMsTUFBT0UsR0FDSEQsRUFBTSxDQUFFSixLQUFNLFFBQVMzQyxLQUFNZ0QsR0FHakNDLFlBQVlGLEVBQUt6SCxZIiwiZmlsZSI6IjkzOS5mMjI4NjNmMS53b3JrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBjYW1lbGNhc2UsIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycyAqL1xuY29uc3QgTlVMTF9QT0lOVEVSID0gMDtcblxuaW50ZXJmYWNlIEFGRkV4cG9ydHMgZXh0ZW5kcyBXZWJBc3NlbWJseS5FeHBvcnRzIHtcbiAgICBlbmNvZGU6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgZGF0YTogbnVtYmVyLCBzaXplOiBudW1iZXIpID0+IG51bWJlcjtcbiAgICBmcmVlX2VuY29kZWRfZGF0YTogKHB0cjogbnVtYmVyKSA9PiAwfDE7XG4gICAgZGVjb2RlOiAoZGF0YTogbnVtYmVyLCBkYXRhU2l6ZTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgc2l6ZTogbnVtYmVyKSA9PiBudW1iZXI7XG4gICAgZ2V0X2xhc3RfYWZmX2V4Y2VwdGlvbjogKCkgPT4gbnVtYmVyO1xuICAgIGZyZWU6IChwdHI6IG51bWJlcikgPT4gbnVtYmVyO1xuICAgIG1hbGxvYzogKHNpemU6IG51bWJlcikgPT4gbnVtYmVyO1xuICAgIF9fZXJybm9fbG9jYXRpb246ICgpID0+IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIEFGRk9wdGlvbnMge1xuICAgIGV4aXQ/OiAoZXhpdENvZGU6IG51bWJlcikgPT4gdW5rbm93bjtcbn1cblxuZXhwb3J0IGNsYXNzIEFGRk5vdFJlYWR5RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgcHVibGljIHJlYWRvbmx5IG5hbWUgPSAnQUZGTm90UmVhZHlFcnJvcic7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ0FGRiBub3QgcmVhZHkgeWV0LiBSZW1lbWJlciBhd2FpdGluZyB0aGUgXCJhZmYucmVhZHlcIiBwcm9taXNlLCBiZWZvcmUgYWNjZXNzaW5nIGFueSBtZXRob2RzIG9yIHByb3BlcnRpZXMuJyk7XG4gICAgfVxufVxuXG5jb25zdCBBRkZfRVhDRVBUSU9OX01TR1MgPSBuZXcgTWFwPG51bWJlciwgc3RyaW5nPihbXG4gICAgWzAsICdPSyddLFxuICAgIFstMSwgJ1Vua25vd24gRXJyb3InXSxcbiAgICBbLTIsICdSZWFkIEVycm9yJ10sXG4gICAgWy0zLCAnQXJndW1lbnQgRXJyb3InXSxcbiAgICBbLTQsICdJbnZhbGlkIFN0YXRlJ10sXG4gICAgWy01LCAnSU8gRXJyb3InXSxcbiAgICBbLTYsICdDb21wcmVzc2lvbiBFcnJvciddLFxuICAgIFstNywgJ0ludmFsaWQgU3RhdGUnXVxuXSk7XG5cbmV4cG9ydCBjbGFzcyBBRkZFeGNlcHRpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2RlOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IEFGRl9FWENFUFRJT05fTVNHUy5nZXQoY29kZSkgPz8gJ1Vua25vd24gRXJyb3IgQ29kZSc7XG5cbiAgICAgICAgc3VwZXIoYCR7bWVzc2FnZX0gKENvZGU6ICR7Y29kZX0pYCk7XG5cbiAgICAgICAgdGhpcy5uYW1lID0gJ0FGRkV4Y2VwdGlvbkVycm9yJztcbiAgICB9XG59XG5cbi8vIFNhZmFyaSBzdGlsbCBjYW4ndCBoYW5kbGUgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcuLi5cbmFzeW5jIGZ1bmN0aW9uIGluc3RhbnRpYXRlV0EocmVzcG9uc2U6IFJlc3BvbnNlIHwgUHJvbWlzZUxpa2U8UmVzcG9uc2U+LCBpbXBvcnRPYmplY3Q/OiBXZWJBc3NlbWJseS5JbXBvcnRzKTogUHJvbWlzZTxXZWJBc3NlbWJseS5JbnN0YW5jZT4ge1xuICAgIGlmIChXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IHsgaW5zdGFuY2UgfSA9IGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKHJlc3BvbnNlLCBpbXBvcnRPYmplY3QpO1xuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgfVxuXG4gICAgY29uc3QgYnl0ZXMgPSBhd2FpdCAoYXdhaXQgcmVzcG9uc2UpLmFycmF5QnVmZmVyKCk7XG4gICAgY29uc3Qgc291cmNlID0gYXdhaXQgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoYnl0ZXMsIGltcG9ydE9iamVjdCk7XG4gICAgcmV0dXJuIHNvdXJjZS5pbnN0YW5jZTtcbn1cblxuZXhwb3J0IGNsYXNzIEFGRiB7XG4gICAgcHJpdmF0ZSBkYXRhVmlldzogRGF0YVZpZXc7XG4gICAgcHJpdmF0ZSBpbnN0YW5jZTogV2ViQXNzZW1ibHkuSW5zdGFuY2V8bnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBtZW1vcnk6IFdlYkFzc2VtYmx5Lk1lbW9yeTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgcmVhZHk6IFByb21pc2U8dm9pZD47XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1Jlc3BvbnNlfFByb21pc2VMaWtlPFJlc3BvbnNlPn0gaW5wdXQgKFByb21pc2UgdGhhdCByZXNvbHZlcyB0bykgUmVzcG9uc2UsIHdoaWNoIGluY2x1ZGVzIFdBU00gTW9kdWxlXG4gICAgICogQHBhcmFtIHtBRkZPcHRpb25zfSBvcHRpb25zIE9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihpbnB1dDogUmVzcG9uc2V8UHJvbWlzZUxpa2U8UmVzcG9uc2U+LCBvcHRpb25zPzogQUZGT3B0aW9ucykge1xuICAgICAgICB0aGlzLm1lbW9yeSA9IG5ldyBXZWJBc3NlbWJseS5NZW1vcnkoeyBpbml0aWFsOiAyNTYsIG1heGltdW06IDMyNzY4IH0pO1xuICAgICAgICB0aGlzLmRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlcik7XG5cbiAgICAgICAgdGhpcy5yZWFkeSA9IGluc3RhbnRpYXRlV0EoXG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBlbnY6IHtcbiAgICAgICAgICAgICAgICAgICAgbWVtb3J5OiB0aGlzLm1lbW9yeSxcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEdldCBpbmZvcm1hdGlvbiBhYm91dCBhIGZpbGUgb3IgZGlyZWN0b3J5LCBnaXZlbiBhIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHBhdGhQdHIgVGhlIHBhdGggb2YgdGhlIGZpbGUgb3IgZGlyZWN0b3J5IHRoYXQgeW91IHdhbnQgaW5mb3JtYXRpb24gYWJvdXQuIChjaGFyICopXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBidWZmZXJQdHIgQSBwb2ludGVyIHRvIGEgYnVmZmVyIHdoZXJlIHRoZSBmdW5jdGlvbiBjYW4gc3RvcmUgdGhlIGluZm9ybWF0aW9uIChzdHJ1Y3Qgc3RhdDY0ICopXG4gICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHswfC0xfSAwID0gU3VjY2VzcyAvIC0xID0gQW4gZXJyb3Igb2NjdXJyZWQgKGVycm5vIGlzIHNldCkuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBfX3N5c19zdGF0NjQ6IChwYXRoUHRyOiBudW1iZXIsIGJ1ZmZlclB0cjogbnVtYmVyKTogMHwtMSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVyck5vKDUpOyAvLyBFSU86IElucHV0L291dHB1dCBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBDYWxsZWQgd2hlbiBtZW1vcnkgaGFzIGdyb3duLiBJbiBhIEpTIHJ1bnRpbWUsIHRoaXMgaXMgdXNlZCB0byBrbm93IHdoZW4gdG8gdXBkYXRlIHRoZSBKUyB2aWV3c1xuICAgICAgICAgICAgICAgICAgICAgKiBvbiB0aGUgd2FzbSBtZW1vcnksIHdoaWNoIG90aGVyd2lzZSB3ZSB3b3VsZCBuZWVkIHRvIGNvbnN0YW50bHkgY2hlY2sgZm9yIGFmdGVyIGFueSB3YXNtIGNvZGVcbiAgICAgICAgICAgICAgICAgICAgICogcnVucy4gU2VlIFt0aGlzIHdhc2kgZGlzY3Vzc2lvbl0oaHR0cHM6Ly9naXRodWIuY29tL1dlYkFzc2VtYmx5L1dBU0kvaXNzdWVzLzgyKS5cbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IFdoaWNoIG1lbW9yeSBoYXMgZ3Jvd25cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGVtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGg6IChpbmRleDogbnVtYmVyKSA9PiB0aGlzLnVwZGF0ZVZpZXdzKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHdhc2lfc25hcHNob3RfcHJldmlldzE6IHtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIFJlYWQgZnJvbSBhIGZpbGUgZGVzY3JpcHRvclxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gZmQgRmlsZSBkZXNjcmlwdG9yXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpb3ZcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGlvdmNudFxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gcG51bVxuICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7MHwtMX0gMCA9IFN1Y2Nlc3MgLyAtMSA9IEFuIGVycm9yIG9jY3VycmVkIChlcnJubyBpcyBzZXQpLlxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZmRfcmVhZDogKGZkOiBudW1iZXIsIGlvdjogbnVtYmVyLCBpb3ZDb3VudDogbnVtYmVyLCBwbnVtOiBudW1iZXIpOiAwfC0xID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyTm8oNSk7IC8vIEVJTzogSW5wdXQvb3V0cHV0IGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIExvc2UgYSBmaWxlIGRlc2NyaXB0b3JcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGZkIEZpbGUgZGVzY3JpcHRvclxuICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7MHwtMX0gMCA9IFN1Y2Nlc3MgLyAtMSA9IEFuIGVycm9yIG9jY3VycmVkIChlcnJubyBpcyBzZXQpLlxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZmRfY2xvc2U6IChmZDogbnVtYmVyKTogMHwtMSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVyck5vKDUpOyAvLyBFSU86IElucHV0L291dHB1dCBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBSZXBvc2l0aW9uIHJlYWQvd3JpdGUgZmlsZSBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGZkIEZpbGUgZGVzY3JpcHRvclxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gb2Zmc2V0TG93XG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXRIaWdoXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aGVuY2VcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG5ld09mZnNldFxuICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7MHwtMX0gMCA9IFN1Y2Nlc3MgLyAtMSA9IEFuIGVycm9yIG9jY3VycmVkIChlcnJubyBpcyBzZXQpLlxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZmRfc2VlazogKGZkOiBudW1iZXIsIG9mZnNldExvdzogbnVtYmVyLCBvZmZzZXRIaWdoOiBudW1iZXIsIHdoZW5jZTogbnVtYmVyLCBuZXdPZmZzZXQ6IG51bWJlcik6IDB8LTEgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFcnJObyg1KTsgLy8gRUlPOiBJbnB1dC9vdXRwdXQgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogV3JpdGUgdG8gYSBmaWxlIGRlc2NyaXB0b3JcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGZkIEZpbGUgZGVzY3JpcHRvclxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gaW92XG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpb3ZDb3VudFxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gcG51bVxuICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7MHwtMX0gMCA9IFN1Y2Nlc3MgLyAtMSA9IEFuIGVycm9yIG9jY3VycmVkIChlcnJubyBpcyBzZXQpLlxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZmRfd3JpdGU6IChmZDogbnVtYmVyLCBpb3Y6IG51bWJlciwgaW92Q291bnQ6IG51bWJlciwgcG51bTogbnVtYmVyKTogMHwtMSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVyck5vKDUpOyAvLyBFSU86IElucHV0L291dHB1dCBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBSZXR1cm4gY29tbWFuZC1saW5lIGFyZ3VtZW50IGRhdGEgc2l6ZXMuXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwZW52aXJvbkNvdW50IChPdXRwdXQgcG9pbnRlcikgVGhlIG51bWJlciBvZiBhcmd1bWVudHMuXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwZW52aXJvbkJ1ZmZlclNpemUgKE91dHB1dCBwb2ludGVyKSBUaGUgc2l6ZSBvZiB0aGUgYXJndW1lbnQgc3RyaW5nIGRhdGEuXG4gICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHswfVxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbl9zaXplc19nZXQ6IChwZW52aXJvbkNvdW50UHRyOiBudW1iZXIsIHBlbnZpcm9uQnVmZmVyU2l6ZVB0cjogbnVtYmVyKTogMHwtMSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFWaWV3LnNldEludDMyKHBlbnZpcm9uQ291bnRQdHIsIDAsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhVmlldy5zZXRJbnQzMihwZW52aXJvbkJ1ZmZlclNpemVQdHIsIDAsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVudmlyb25fZ2V0OiAoZW52aXJvbjogbnVtYmVyLCBlbnZpcm9uQnVmZmVyUHRyOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBDYWxsZWQgb24gcHJvZ3JhbSBleGl0XG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBleGl0Q29kZSBFeGl0IGNvZGVcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHByb2NfZXhpdDogKGV4aXRDb2RlOiBudW1iZXIpOiB2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM/LmV4aXQ/LihleGl0Q29kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICkudGhlbihpbnN0YW5jZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVZpZXdzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0IGV4cG9ydHMoKTogQUZGRXhwb3J0c3xudWxsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U/LmV4cG9ydHMgYXMgQUZGRXhwb3J0cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhpcy5kYXRhVmlldy4gVGhpcyBpcyBjYWxsZWQgb25jZSBpbml0aWFsbHksIHdoZW4gdGhlIFdBU00gbG9hZHNcbiAgICAgKiBhbmQgZXZlcnkgdGltZSBtZW1vcnkgZ3Jvd3MgLyBzaHJpbmtzIGFuZCB0aGVyZWZvcmUgdGhlIHVuZGVybHlpbmcgbWVtb3J5XG4gICAgICogYnVmZmVyIGNoYW5nZXMuXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGVWaWV3cygpIHtcbiAgICAgICAgdGhpcy5kYXRhVmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFsbG9jYXRlIG1lbW9yeSBibG9ja1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaXplIFNpemUgb2YgdGhlIG1lbW9yeSBibG9jaywgaW4gYnl0ZXMuXG4gICAgICogQHJldHVybnMge251bWJlcn0gVGhpcyBmdW5jdGlvbiByZXR1cm5zIGEgcG9pbnRlciB0byB0aGUgYWxsb2NhdGVkIG1lbW9yeS5cbiAgICAgKi9cbiAgICBwcml2YXRlIG1hbGxvYyhzaXplOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICBpZiAodGhpcy5leHBvcnRzID09PSBudWxsKSB0aHJvdyBuZXcgQUZGTm90UmVhZHlFcnJvcigpO1xuXG4gICAgICAgIGNvbnN0IHB0ciA9IHRoaXMuZXhwb3J0cy5tYWxsb2Moc2l6ZSk7XG4gICAgICAgIGlmIChwdHIgPT09IE5VTExfUE9JTlRFUikgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gYWxsb2NhdGUgbWVtb3J5Jyk7XG5cbiAgICAgICAgcmV0dXJuIHB0cjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWFsbG9jYXRlIG1lbW9yeSBwcmV2aW91c2x5IGFsbG9jYXRlZFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwdHIgVGhpcyBpcyB0aGUgcG9pbnRlciB0byBhIG1lbW9yeSBibG9jayBwcmV2aW91c2x5IGFsbG9jYXRlZFxuICAgICAqL1xuICAgIHByaXZhdGUgZnJlZShwdHI6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5leHBvcnRzID09PSBudWxsKSB0aHJvdyBuZXcgQUZGTm90UmVhZHlFcnJvcigpO1xuXG4gICAgICAgIHRoaXMuZXhwb3J0cy5mcmVlKHB0cik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV3JpdGUgYnVmZmVyIHRvIG1lbW9yeS4gVGhpcyB3aWxsIGF1dG9tYXRpY2FsbHkgYWxsb2NhdGUgbWVtb3J5LlxuICAgICAqIFlvdSBzaG91bGQgcmVtZW1iZXIgdG8gZnJlZSB0aGUgbWVtb3J5IGFmdGVyIHlvdSdyZSBkb25lIHVzaW5nIGl0LlxuICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJMaWtlfSBidWZmZXJcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBQb2ludGVyIHRvIHRoZSBhbGxvY2F0ZWQgbWVtb3J5LlxuICAgICAqL1xuICAgIHByaXZhdGUgd3JpdGVCdWZmZXJUb01lbW9yeShidWZmZXI6IEFycmF5QnVmZmVyTGlrZSk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHB0ciA9IHRoaXMubWFsbG9jKGJ1ZmZlci5ieXRlTGVuZ3RoKTtcblxuICAgICAgICBjb25zdCBhcnIgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGFWaWV3LnNldFVpbnQ4KHB0ciArIGksIGFycltpXSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcHRyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcHkgZnJvbSBtZW1vcnlcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gcHRyIFBvaW50ZXIgdG8gZGF0YVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaXplIFNpemVcbiAgICAgKiBAcmV0dXJucyB7VWludDhBcnJheX1cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldEJ5dGVzRnJvbU1lbW9yeShwdHI6IG51bWJlciwgc2l6ZTogbnVtYmVyKTogVWludDhBcnJheSB7XG4gICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIpLnNsaWNlKHB0ciwgcHRyICsgc2l6ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IGVycm5vXG4gICAgICogQHBhcmFtIGVycm5vIGVycm5vXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZXRFcnJObyhlcnJubzogbnVtYmVyKSB7XG4gICAgICAgIGlmICh0aGlzLmV4cG9ydHMgPT09IG51bGwpIHRocm93IG5ldyBBRkZOb3RSZWFkeUVycm9yKCk7XG5cbiAgICAgICAgdGhpcy5kYXRhVmlldy5zZXRJbnQzMih0aGlzLmV4cG9ydHMuX19lcnJub19sb2NhdGlvbigpLCBlcnJubyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGVycm9yLCB3aGljaCBjb3JyZXNwb25kcyB0byBsYXN0IHRocm93biBncmFkX2FmZiBleGNlcHRpb25cbiAgICAgKiBAcmV0dXJucyBFcnJvciBhY2NvcmRpbmcgdG8gbGFzdCBleGNlcHRpb25cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldExhc3RBRkZFeGNlcHRpb24oKTogQUZGRXhjZXB0aW9uRXJyb3Ige1xuICAgICAgICBpZiAodGhpcy5leHBvcnRzID09PSBudWxsKSB0aHJvdyBuZXcgQUZGTm90UmVhZHlFcnJvcigpO1xuXG4gICAgICAgIGNvbnN0IG51bSA9IHRoaXMuZXhwb3J0cy5nZXRfbGFzdF9hZmZfZXhjZXB0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBBRkZFeGNlcHRpb25FcnJvcihudW0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuY29kZSBpbWFnZSBkYXRhIHRvIFBBQSBieXRlc1xuICAgICAqIEBwYXJhbSB7SW1hZ2VEYXRhfSBpbWFnZURhdGEgSW1hZ2UgZGF0YVxuICAgICAqIEByZXR1cm5zIHtVaW50OEFycmF5fSBieXRlLWVuY29kZWQgUEFBXG4gICAgICpcbiAgICAgKiBAdGhyb3dzIHtAbGluayBBRkZOb3RSZWFkeUVycm9yfVxuICAgICAqIFRocm93biBpZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBiZWZvcmUgQUZGIGluc3RhbmNlIGlzIHJlYWR5LiAoYXdhaXQgdGhlIC5yZWFkeSBwcm9taXNlIHRvIHByZXZlbnQgdGhpcylcbiAgICAgKlxuICAgICAqIEB0aHJvd3Mge0BsaW5rIEFGRkV4Y2VwdGlvbkVycm9yfVxuICAgICAqIFRocm93biBpZiBncmFkX2FmZiBpbXBsZW1lbnRhdGlvbiB0aHJvd3MgYW55IGV4Y2VwdGlvbnMuXG4gICAgICovXG4gICAgcHVibGljIGVuY29kZShpbWFnZURhdGE6IEltYWdlRGF0YSk6IFVpbnQ4QXJyYXkge1xuICAgICAgICBpZiAodGhpcy5leHBvcnRzID09PSBudWxsKSB0aHJvdyBuZXcgQUZGTm90UmVhZHlFcnJvcigpO1xuXG4gICAgICAgIGNvbnN0IHNpemVQdHIgPSB0aGlzLm1hbGxvYyg0KTtcbiAgICAgICAgY29uc3QgaW1hZ2VEYXRhUHRyID0gdGhpcy53cml0ZUJ1ZmZlclRvTWVtb3J5KGltYWdlRGF0YS5kYXRhLmJ1ZmZlcik7XG5cbiAgICAgICAgY29uc3QgcHRyID0gdGhpcy5leHBvcnRzLmVuY29kZShpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHQsIGltYWdlRGF0YVB0ciwgc2l6ZVB0cik7XG4gICAgICAgIGlmIChwdHIgPT09IE5VTExfUE9JTlRFUikgdGhyb3cgdGhpcy5nZXRMYXN0QUZGRXhjZXB0aW9uKCk7XG5cbiAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuZGF0YVZpZXcuZ2V0VWludDMyKHNpemVQdHIsIHRydWUpO1xuICAgICAgICBjb25zdCBvdXRwdXQgPSB0aGlzLmdldEJ5dGVzRnJvbU1lbW9yeShwdHIsIHNpemUpO1xuXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSB0aGlzLmV4cG9ydHMuZnJlZV9lbmNvZGVkX2RhdGEocHRyKTtcbiAgICAgICAgaWYgKHN1Y2Nlc3MgPT09IDApIHRocm93IHRoaXMuZ2V0TGFzdEFGRkV4Y2VwdGlvbigpO1xuICAgICAgICB0aGlzLmZyZWUoc2l6ZVB0cik7XG4gICAgICAgIHRoaXMuZnJlZShpbWFnZURhdGFQdHIpO1xuXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jb2RlIFBBQSBieXRlcyB0byBpbWFnZSBkYXRhXG4gICAgICogQHBhcmFtIHtVaW50OEFycmF5fSBkYXRhIGJ5dGUtZW5jb2RlZCBQQUFcbiAgICAgKiBAcmV0dXJucyB7SW1hZ2VEYXRhfSBpbWFnZSBkYXRhXG4gICAgICpcbiAgICAgKiBAdGhyb3dzIHtAbGluayBBRkZOb3RSZWFkeUVycm9yfVxuICAgICAqIFRocm93biBpZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBiZWZvcmUgQUZGIGluc3RhbmNlIGlzIHJlYWR5LiAoYXdhaXQgdGhlIC5yZWFkeSBwcm9taXNlIHRvIHByZXZlbnQgdGhpcylcbiAgICAgKlxuICAgICAqIEB0aHJvd3Mge0BsaW5rIEFGRkV4Y2VwdGlvbkVycm9yfVxuICAgICAqIFRocm93biBpZiBncmFkX2FmZiBpbXBsZW1lbnRhdGlvbiB0aHJvd3MgYW55IGV4Y2VwdGlvbnMuXG4gICAgICovXG4gICAgcHVibGljIGRlY29kZShkYXRhOiBVaW50OEFycmF5KTogSW1hZ2VEYXRhIHtcbiAgICAgICAgaWYgKHRoaXMuZXhwb3J0cyA9PT0gbnVsbCkgdGhyb3cgbmV3IEFGRk5vdFJlYWR5RXJyb3IoKTtcblxuICAgICAgICBjb25zdCBvdXRwdXRTaXplUHRyID0gdGhpcy5tYWxsb2MoNCk7XG4gICAgICAgIGNvbnN0IHdpZHRoUHRyID0gdGhpcy5tYWxsb2MoMik7XG4gICAgICAgIGNvbnN0IGhlaWdodFB0ciA9IHRoaXMubWFsbG9jKDIpO1xuICAgICAgICBjb25zdCBkYXRhUHRyID0gdGhpcy53cml0ZUJ1ZmZlclRvTWVtb3J5KGRhdGEuYnVmZmVyKTtcblxuICAgICAgICBjb25zdCBwdHIgPSB0aGlzLmV4cG9ydHMuZGVjb2RlKGRhdGFQdHIsIGRhdGEubGVuZ3RoLCB3aWR0aFB0ciwgaGVpZ2h0UHRyLCBvdXRwdXRTaXplUHRyKTtcbiAgICAgICAgaWYgKHB0ciA9PT0gTlVMTF9QT0lOVEVSKSB0aHJvdyB0aGlzLmdldExhc3RBRkZFeGNlcHRpb24oKTtcblxuICAgICAgICBjb25zdCBzaXplID0gdGhpcy5kYXRhVmlldy5nZXRVaW50MzIob3V0cHV0U2l6ZVB0ciwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5kYXRhVmlldy5nZXRVaW50MTYod2lkdGhQdHIsIHRydWUpO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmRhdGFWaWV3LmdldFVpbnQxNihoZWlnaHRQdHIsIHRydWUpO1xuICAgICAgICBjb25zdCBvdXRwdXQgPSB0aGlzLmdldEJ5dGVzRnJvbU1lbW9yeShwdHIsIHNpemUpO1xuXG4gICAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkob3V0cHV0LmJ1ZmZlciksIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgICAgIHRoaXMuZnJlZShvdXRwdXRTaXplUHRyKTtcbiAgICAgICAgdGhpcy5mcmVlKHdpZHRoUHRyKTtcbiAgICAgICAgdGhpcy5mcmVlKGhlaWdodFB0cik7XG4gICAgICAgIHRoaXMuZnJlZShkYXRhUHRyKTtcblxuICAgICAgICByZXR1cm4gaW1hZ2U7XG4gICAgfVxufVxuXG4vKipcbiAqIEBwYXJhbSB7UmVxdWVzdHxSZXF1ZXN0SW5mb3xVUkx8UmVzcG9uc2V8UHJvbWlzZTxSZXNwb25zZT59IGlucHV0XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGluaXQoaW5wdXQ6IFJlcXVlc3R8UmVxdWVzdEluZm98VVJMfFJlc3BvbnNlfFByb21pc2U8UmVzcG9uc2U+ID0gJy9ncmFkX2FmZl9wYWEud2FzbScsIG9wdGlvbnM/OiBBRkZPcHRpb25zKTogUHJvbWlzZTxBRkY+IHtcbiAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJyB8fCBpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QgfHwgaW5wdXQgaW5zdGFuY2VvZiBVUkwpIHtcbiAgICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2YgVVJMKSBpbnB1dCA9IGlucHV0LnRvU3RyaW5nKCk7XG5cbiAgICAgICAgaW5wdXQgPSBmZXRjaChpbnB1dCk7XG4gICAgfVxuXG4gICAgY29uc3QgaW5pdE9iaiA9IG5ldyBBRkYoaW5wdXQsIG9wdGlvbnMpO1xuICAgIGF3YWl0IGluaXRPYmoucmVhZHk7XG5cbiAgICByZXR1cm4gaW5pdE9iajtcbn1cbiIsInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuaW1wb3J0IGluaXQgZnJvbSAnQC91dGlscy9hZmYnO1xuaW1wb3J0IHsgUEFBX01JTUVfVFlQRSB9IGZyb20gJ0AvdXRpbHMvZmlsZSc7XG4vKipcbiAqIEdlbmVyYXRlIGEgcGFhIGZyb20gYW4gSW1hZ2VEYXRhIG9iamVjdFxuICogQHBhcmFtIHtJbWFnZURhdGF9IGRhdGEgaW1hZ2UgZGF0YVxuICogQHJldHVybnMge1Byb21pc2U8QmxvYj59IHRoZSBwYWEgYXMgYSBibG9iXG4gKi9cbmZ1bmN0aW9uIGNvbnZlcnRJbWFnZVRvUGFhKGRhdGEpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBhZmYgPSB5aWVsZCBpbml0KCk7XG4gICAgICAgIGNvbnN0IHVpbnQ4YXJyYXkgPSBhZmYuZW5jb2RlKGRhdGEpO1xuICAgICAgICByZXR1cm4gbmV3IEJsb2IoW3VpbnQ4YXJyYXkuYnVmZmVyXSwgeyB0eXBlOiBQQUFfTUlNRV9UWVBFIH0pO1xuICAgIH0pO1xufVxuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgaW1hZ2VEYXRlID0gZXZlbnQuZGF0YTtcbiAgICBsZXQgbXNnO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGJsb2IgPSB5aWVsZCBjb252ZXJ0SW1hZ2VUb1BhYShpbWFnZURhdGUpO1xuICAgICAgICBtc2cgPSB7IHR5cGU6ICdkYXRhJywgZGF0YTogYmxvYiB9O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIG1zZyA9IHsgdHlwZTogJ2Vycm9yJywgZGF0YTogZXJyIH07XG4gICAgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgcG9zdE1lc3NhZ2UobXNnLCB0aGlzKTtcbn0pKTtcbiIsIi8qKlxuICogV2h5IGRvIHdlIG5vdCBqdXN0IHVzZSBGaWxlP1xuICogV2VsbC4uLiBiZWNhdXNlIG9sZCBFZGdlIGlzIHNoaXR0eSBhZiBhbmQgY2FuJ3QgaGFuZGxlIHRoZSBGaWxlIGNvbnN0cnVjdG9yIChzZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzQzMjQxOTIyKVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEdyYWRQYWFGaWxlIHtcbiAgICBibG9iOiBCbG9iO1xuICAgIG5hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IFBBQV9NSU1FX1RZUEUgPSAnaW1hZ2Uvdm5kLnBhYSc7XG5cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gZmlsZSBpcyBzdXBwb3J0ZWRcbiAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxlXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gRmlsZSBpcyBzdXBwb3J0ZWQ/XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1N1cHBvcnRlZEZpbGUgKHsgYmxvYiwgbmFtZSB9OiBHcmFkUGFhRmlsZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoWydpbWFnZS9wbmcnLCAnaW1hZ2Uvc3ZnK3htbCcsICdpbWFnZS9qcGVnJywgUEFBX01JTUVfVFlQRV0uaW5jbHVkZXMoYmxvYi50eXBlKSB8fCAvXFwucGFhJC9pLnRlc3QobmFtZSkpO1xufVxuXG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIGZpbGUgaXMgc3VwcG9ydGVkXG4gKiBAcGFyYW0ge0ZpbGV9IGZpbGUgRmlsZVxuICogQHJldHVybnMge3N0cmluZ3x1bmRlZmluZWR9IGZpbGUgZXh0ZW5zaW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlRXh0ZW5zaW9uIChuYW1lOiBzdHJpbmcpOiBzdHJpbmd8dW5kZWZpbmVkIHtcbiAgICBjb25zdCBleHQ6IHVuZGVmaW5lZHxzdHJpbmcgPSBuYW1lLnNwbGl0KCcuJykucG9wKCk7XG5cbiAgICByZXR1cm4gZXh0Py50b0xvd2VyQ2FzZSgpO1xufVxuXG4vKipcbiAqIEdldCBmaWxlJ3MgbmFtZSB3aXRob3V0IGV4dGVuc2lvblxuICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IGZpbGUgbmFtZSB3aXRob3V0IGV4dGVuc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmlsZU5hbWVXaXRob3V0RXh0ZW5zaW9uIChuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBuYW1lLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKTtcbn1cblxuLyoqXG4gKiBEb3dubG9hZCBnaXZlbiBmaWxlXG4gKiBAcGFyYW0ge0ZpbGV9IGZpbGUgRmlsZSB0byBkb3dubG9hZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZG93bmxvYWQgKGZpbGU6IEdyYWRQYWFGaWxlKTogdm9pZCB7XG4gICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlLmJsb2IpO1xuXG4gICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBsaW5rLmRvd25sb2FkID0gZmlsZS5uYW1lO1xuICAgIGxpbmsuaHJlZiA9IHVybDtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xuICAgIGxpbmsuY2xpY2soKTtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xuICAgIGxpbmsucmVtb3ZlKCk7XG5cbiAgICAvLyB3ZSByZXZva2UgdGhlIHVybCBvbmx5IGFmdGVyIGEgZGVsYXkgYmVjYXVzZSBvbGQgRWRnZSBjYW4ndCBoYW5kbGUgaXQgb3RoZXJ3aXNlXG4gICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpLCAyMDApO1xufVxuXG4vKipcbiAqIFJlYWRzIGZpbGUgYXMgYSBhcnJheSBidWZmZXJcbiAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxlIHRvIHJlYWRcbiAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5QnVmZmVyPn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlYWRGaWxlIChmaWxlOiBCbG9iKTogUHJvbWlzZTxBcnJheUJ1ZmZlcj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQgYXMgQXJyYXlCdWZmZXIpO1xuICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpO1xuICAgIH0pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==