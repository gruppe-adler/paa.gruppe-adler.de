(()=>{"use strict";var e=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{A(r.next(e))}catch(e){o(e)}}function a(e){try{A(r.throw(e))}catch(e){o(e)}}function A(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}A((r=r.apply(e,t||[])).next())}))};class t extends Error{constructor(){super('AFF not ready yet. Remember awaiting the "aff.ready" promise, before accessing any methods or properties.'),this.name="AFFNotReadyError"}}const n=new Map([[0,"OK"],[-1,"Unknown Error"],[-2,"Read Error"],[-3,"Argument Error"],[-4,"Invalid State"],[-5,"IO Error"],[-6,"Compression Error"],[-7,"Invalid State"]]);class r extends Error{constructor(e){var t;super(`${null!==(t=n.get(e))&&void 0!==t?t:"Unknown Error Code"} (Code: ${e})`),this.name="AFFExceptionError"}}class i{constructor(t,n){this.instance=null,this.memory=new WebAssembly.Memory({initial:256,maximum:32768}),this.dataView=new DataView(this.memory.buffer),this.ready=function(t,n){return e(this,void 0,void 0,(function*(){if(void 0!==WebAssembly.instantiateStreaming){const{instance:e}=yield WebAssembly.instantiateStreaming(t,n);return e}const e=yield(yield t).arrayBuffer();return(yield WebAssembly.instantiate(e,n)).instance}))}(t,{env:{memory:this.memory,__sys_stat64:(e,t)=>(this.setErrNo(5),-1),emscripten_notify_memory_growth:e=>this.updateViews()},wasi_snapshot_preview1:{fd_read:(e,t,n,r)=>(this.setErrNo(5),-1),fd_close:e=>(this.setErrNo(5),-1),fd_seek:(e,t,n,r,i)=>(this.setErrNo(5),-1),fd_write:(e,t,n,r)=>(this.setErrNo(5),-1),environ_sizes_get:(e,t)=>(this.dataView.setInt32(e,0,!0),this.dataView.setInt32(t,0,!0),0),environ_get:(e,t)=>0,proc_exit:e=>{var t;null===(t=null==n?void 0:n.exit)||void 0===t||t.call(n,e)}}}).then((e=>{this.instance=e,this.updateViews()}))}get exports(){var e;return null===(e=this.instance)||void 0===e?void 0:e.exports}updateViews(){this.dataView=new DataView(this.memory.buffer)}malloc(e){if(null===this.exports)throw new t;const n=this.exports.malloc(e);if(0===n)throw new Error("Failed to allocate memory");return n}free(e){if(null===this.exports)throw new t;this.exports.free(e)}writeBufferToMemory(e){const t=this.malloc(e.byteLength),n=new Uint8Array(e);for(let e=0;e<n.length;e++)this.dataView.setUint8(t+e,n[e]);return t}getBytesFromMemory(e,t){return new Uint8Array(this.memory.buffer).slice(e,e+t)}setErrNo(e){if(null===this.exports)throw new t;this.dataView.setInt32(this.exports.__errno_location(),e)}getLastAFFException(){if(null===this.exports)throw new t;const e=this.exports.get_last_aff_exception();return new r(e)}encode(e){if(null===this.exports)throw new t;const n=this.malloc(4),r=this.writeBufferToMemory(e.data.buffer),i=this.exports.encode(e.width,e.height,r,n);if(0===i)throw this.getLastAFFException();const o=this.dataView.getUint32(n,!0),s=this.getBytesFromMemory(i,o);if(0===this.exports.free_encoded_data(i))throw this.getLastAFFException();return this.free(n),this.free(r),s}decode(e){if(null===this.exports)throw new t;const n=this.malloc(4),r=this.malloc(2),i=this.malloc(2),o=this.writeBufferToMemory(e.buffer),s=this.exports.decode(o,e.length,r,i,n);if(0===s)throw this.getLastAFFException();const a=this.dataView.getUint32(n,!0),A=this.dataView.getUint16(r,!0),c=this.dataView.getUint16(i,!0),h=this.getBytesFromMemory(s,a),d=new ImageData(new Uint8ClampedArray(h.buffer),A,c);return this.free(n),this.free(r),this.free(i),this.free(o),d}}function o(e){return t=this,n=void 0,i=function*(){const t=new Image;t.decoding="async",t.src=e;const n=new Promise(((e,n)=>{t.onload=()=>e(),t.onerror=()=>n(Error("Image loading error"))}));return t.decode&&(yield t.decode().catch((()=>null))),yield n,t},new((r=void 0)||(r=Promise))((function(e,o){function s(e){try{A(i.next(e))}catch(e){o(e)}}function a(e){try{A(i.throw(e))}catch(e){o(e)}}function A(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}A((i=i.apply(t,n||[])).next())}));var t,n,r,i}var s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{A(r.next(e))}catch(e){o(e)}}function a(e){try{A(r.throw(e))}catch(e){o(e)}}function A(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}A((r=r.apply(e,t||[])).next())}))};s(void 0,void 0,void 0,(function*(){const e=[["image/vnd.paa","PAA"],["image/png","PNG"],["image/jpeg","JPEG"],["image/svg+xml","SVG"],["image/bmp","BMP"],["image/gif","GIF"],["image/x-icon","ICO"]],t=yield Promise.all([a(["image/webp","WebP"],"data:image/webp;base64,UklGRhYAAABXRUJQVlA4TAoAAAAvAAAAAEX/I/of"),a(["image/avif","AVIF"],"data:image/avif;base64,AAAAFGZ0eXBhdmlmAAAAAG1pZjEAAACgbWV0YQAAAAAAAAAOcGl0bQAAAAAAAQAAAB5pbG9jAAAAAEQAAAEAAQAAAAEAAAC8AAAAGwAAACNpaW5mAAAAAAABAAAAFWluZmUCAAAAAAEAAGF2MDEAAAAARWlwcnAAAAAoaXBjbwAAABRpc3BlAAAAAAAAAAQAAAAEAAAADGF2MUOBAAAAAAAAFWlwbWEAAAAAAAAAAQABAgECAAAAI21kYXQSAAoIP8R8hAQ0BUAyDWeeUy0JG+QAACANEkA="),a(["image/jxl","JPEG XL"],"data:image/jxl;base64,/woAELASCAgQADAASxLFgoUUlw17/v8f")]);for(const n of t)void 0!==n&&e.push(n);return new Map(e)}));function a(e,t){return s(this,void 0,void 0,(function*(){try{yield o(t)}catch(e){return}return e}))}new RegExp(`\\.(${["paa"].join("|")})$`,"i");var A=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{A(r.next(e))}catch(e){o(e)}}function a(e){try{A(r.throw(e))}catch(e){o(e)}}function A(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}A((r=r.apply(e,t||[])).next())}))};function c(t){return A(this,void 0,void 0,(function*(){const n=yield(r=t,new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsArrayBuffer(r)})));var r;const o=new Uint8Array(n);return(yield function(t="/grad_aff_paa.wasm",n){return e(this,void 0,void 0,(function*(){("string"==typeof t||t instanceof Request||t instanceof URL)&&(t instanceof URL&&(t=t.toString()),t=fetch(t));const e=new i(t,n);return yield e.ready,e}))}()).decode(o)}))}addEventListener("message",(e=>A(void 0,void 0,void 0,(function*(){const t=e.data;let n;try{n={type:"data",data:yield c(t)}}catch(e){n=e instanceof Error?{type:"error",data:e.toString()}:{type:"error",data:e}}postMessage(n,this)}))))})();